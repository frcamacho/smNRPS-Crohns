clustering_method = "complete",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "binary", cellwidth = 3,cellheight = 3,
clustering_method = "average",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "binary", clustering_distance_cols = "binary", cellwidth = 3,cellheight = 3,
clustering_method = "average",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "average",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "complete",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "centroid",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "median",main="Ward.D2 Clustering with Binary")
lefse_CD_C_features_top30 <- lefse_CD_C_discriminative_features %>% group_by(class_discriminitive) %>% arrange(desc(LDA_score)) %>% group_by(class_discriminitive) %>% top_n(30, LDA_score)
df_enriched_CD_C_top30 <- filter_quantifier_df %>% filter(bgcName %in% lefse_CD_C_features_top30$BGC) %>% filter(GroupAttribute!="UC")
quantile(df_enriched_CD_C_top30$RPKM, probs = c(.05, .90)) #    5% = 0.4223711  90% =17.7351081
heatmap_RS_top30<-df_enriched_CD_C_top30  %>% select(c(-Coverage))
heatmap_RS_top30$RPKM[heatmap_RS_top30$RPKM > 20 ] <- 20
data_wide_top30 <- dcast(heatmap_RS_top30, bgcName ~ Sample, value.var="RPKM")
row.names(data_wide_top30)<- data_wide_top30$bgcName
data_wide_top30<-data_wide_top30[,-1]
data_wide_top30[is.na(data_wide_top30)] <- 0
data_wide_top30<-as.matrix(data_wide_top30)
bk_3 = unique(c(seq(0,.05, length=100), seq(.06,20 ,length=1000)))
hmcols_3<- colorRampPalette(c("white","blue","green","yellow","orange","red"))(length(bk_3)-1)
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "median",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "mcquitty",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "mcquitty",main="Mcquitty with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "ward.D",main="Ward.D2 Clustering with Binary")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "ward.D2",main="Ward.D2 Clustering with correlation")
lefse_CD_C_features_top30 <- lefse_CD_C_discriminative_features %>% group_by(class_discriminitive) %>% arrange(desc(LDA_score)) %>% group_by(class_discriminitive) %>% top_n(30, LDA_score)
df_enriched_CD_C_top30 <- filter_quantifier_df %>% filter(bgcName %in% lefse_CD_C_features_top30$BGC) %>% filter(GroupAttribute!="UC")
quantile(df_enriched_CD_C_top30$RPKM, probs = c(.05, .90)) #    5% = 0.4223711  90% =17.7351081
heatmap_RS_top30<-df_enriched_CD_C_top30  %>% select(c(-Coverage))
heatmap_RS_top30$RPKM[heatmap_RS_top30$RPKM > 20 ] <- 20
data_wide_top30 <- dcast(heatmap_RS_top30, bgcName ~ Sample, value.var="RPKM")
row.names(data_wide_top30)<- data_wide_top30$bgcName
data_wide_top30<-data_wide_top30[,-1]
data_wide_top30[is.na(data_wide_top30)] <- 0
data_wide_top30<-as.matrix(data_wide_top30)
bk_3 = unique(c(seq(0,.05, length=100), seq(.06,20 ,length=1000)))
hmcols_3<- colorRampPalette(c("white","blue","green","yellow","orange","red"))(length(bk_3)-1)
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "ward.D",main="Ward.D Clustering with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "ward.D2",main="Ward.D2 Clustering with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "mcquitty",main="Mcquitty with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "complete",main="complete with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "Complete",main="Complete with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "correlation", cellwidth = 3,cellheight = 3,
clustering_method = "complete",main="Complete with correlation")
pheatmap::pheatmap(data_wide_top30, scale = "none",breaks=bk_3, color=hmcols_3,annotation_col= annotations_col, annotation_row = annotations_row, show_rownames=TRUE, show_colnames = FALSE,fontsize_row = 6,
clustering_distance_rows = "correlation", clustering_distance_cols = "binary", cellwidth = 3,cellheight = 3,
clustering_method = "complete",main="Complete with correlation")
require(tidyverse)
compare_C_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-CD",
col_names = F, delim = "\t")
names(compare_C_clusters)<- c("sseqid", "qseqid", "qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend")
head(compare_C_clusters)
compare_C_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-CD",
col_names = F, delim = "\t")
names(compare_C_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend")
head(compare_C_clusters)
as.data.frame(compare_C_clusters)
compare_C_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-CD",
col_names = F, delim = "\t")
names(compare_C_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
head(compare_C_clusters)
compare_C_clusters %>% mutate(sqcov= round(pmax(sstart,send)-pmin(sstartsend,)/slen)*100)))
compare_C_clusters %>% mutate(sqcov= round((pmax(sstart,send)-pmin(sstartsend,)/slen)*100))
compare_C_clusters %>% mutate(sqcov= round((pmax(sstart,send)-pmin(sstart,send)/slen)*100))
compare_C_clusters %>% mutate(sqcov= round((pmax(sstart,send)-pmin(sstart,send)/slen)*100)) %>% head()
851-786
65/11165
0.005821764*100
compare_C_clusters %>% mutate(sqcov= (pmax(sstart,send)-pmin(sstart,send)/slen)*100)
compare_C_clusters %>% mutate(smax= pmax(sstart,send))
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmax(sstart,send))
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send))
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send)) %>% mutate(((smax-smin)/slen )*100)
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send)) %>% mutate(sqcov=((smax-smin)/slen )*100))
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send)) %>% mutate(sqcov=((smax-smin/slen )*100))
8.51e4
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send)) %>% mutate(sqcov=((smax-smin)/slen ))
compare_C_clusters %>% mutate(smax= pmax(sstart,send)) %>% mutate(smin= pmin(sstart,send)) %>% mutate(sqcov=((smax-smin)/slen )*100)
compare_C_clusters %>%  mutate(sqcov=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
ident_C_bgcs<-compare_C_clusters %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter(qcovs >=95 | sqcovs >=95)
head(ident_C_bgcs)
as.data.frame(ident_C_bgcs)
compare_C_clusters
compare_C_clusters %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
compare_C_clusters %>% filter(qlen>slen) %>% filter(qcovs >=95 )
compare_C_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
compare_C_clusters %>% filter(qlen<slen)
compare_C_clusters %>% filter(slen<qlen)
compare_C_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
compare_C_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_C_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
compare_C_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 ) %>% as.data.frame()
ident_C_bgcs
compare_CD_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-CD_against-C",
col_names = F, delim = "\t")
names(compare_CD_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_CD_clusters
compare_CD_clusters %>% as.data.frame()
compare_CD_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
compare_CD_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 ) %>% as.data.frame()
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_CD_clusters
compare_CD_clusters %>% as.data.frame()
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% as.data.frame()
compare_CD_clusters
compare_CD_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-CD_against-C",
col_names = F, delim = "\t")
compare_CD_clusters %>% as.data.frame()
names(compare_CD_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_CD_clusters %>% as.data.frame()
compare_UC_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-UC_against-C",
col_names = F, delim = "\t")
names(compare_UC_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_UC_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-UC_against-C",
col_names = F, delim = "\t")
head(compare_UC_clusters)
compare_C_UC_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-UC",
col_names = F, delim = "\t")
compare_C_UC_clusterscompare_C_UC_clusters
compare_C_UC_clusters
names(compare_C_UC_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
head(compare_C_UC_clusters)
compare_C_UC_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
as.data.frame(compare_C_UC_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 ))
compare_C_UC_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_C_UC_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
head(compare_C_UC_clusters)
compare_C_UC_clusters
compare_C_UC_clusters %>% as.data.frame()
compare_UC_clusters
compare_CD_clusters
compare_C_clusters
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)  %>% as.data.frame()
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T)
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
head(blast_df)
blast_df %>% as.data.frame()
blast_df %>% as.data.frame() %>% head()
blast_df %>% group_by(sseqid,Sample) %>% filter(duplicated(sseqid))
blast_df %>% group_by(sseqid,Sample) %>% filter(duplicated(sseqid)) %>% as.data.frame()
blast_df %>% filter(sseqid == "A201L5ABXX:3:25:16105:34822#ACTTGAA/1")
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP")
head(blast_df_smnrps)
dim(blast_df_smnrps)
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP") %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
head(blast_df_smnrps)
compare_C_UC_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))+1/slen )*100) %>% filter( sqcovs >=95)
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP") %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))+1/slen )*100)
head(blast_df_smnrps)
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP") %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send)+1)/slen )*100)
head(blast_df_smnrps)
dim(blast_df_smnrps)
tail(blast_df_smnrps)
head(blast_df_smnrps %>% as.data.frame())
blast_df_smnrps %>% as.data.frame() %>% filter(sqcovs <=50)
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP") %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send)+1)/slen )*100) %>% filter(sqcovs >=50)
head(blast_df_smnrps)
dim(blast_df_smnrps)
blast_df_smnrps %>% arrange(desc(sqcovs)) %>% tail(n=50)
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
blast_df_smnrps<- blast_df %>% filter(qseqid != "smNRPS-BP") %>%  mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send)+1)/slen )*100) %>% filter(sqcovs >=50)
filterBlastReads<-function(blastDF){
filterDF<-data.frame()
for (i in 1:nrow(blastDF)){
external <- NULL
row <- blastDF[i,]
smin <- min(row$sstart, row$send)
smax <- max(row$sstart, row$send)
qmin <- min(row$qstart, row$qend)
qmax <- max(row$qstart, row$qend)
percentReadCoveredByCluster <- ((smax - smin + 1) / (row$slen) )* 100
if(qmin - 1 >= smin - 1  && row$qlen - qmax >= row$slen - smax){
external <- TRUE
}else{
external <- FALSE}
if (external == TRUE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 90)){
row$readPos <- "external"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )
}} else if (external == FALSE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 50)){
row$readPos <- "edge"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )}}
}
return(filterDF)
}
blast_df_filter<-filterBlastReads( blast_df %>% filter(qseqid != "smNRPS-BP"))
dim(blast_df_filter)
dim(blast_df)
blast_df %>% filter(qseqid != "smNRPS-BP") %>% dim(.)
head(blast_df_filter)
blast_df_filter%>% filter(readPos == "internal")
blast_df_filter%>% filter(readPos == "edge")
blast_df_filter%>% filter(readPos == "external")
unique(blast_df_filter$qseqid)
blast_df_filter_count<-blast_df_filter %>% group_by(sseqid) %>% count()
head(blast_df_filter_count)
max(blast_df_filter_count$n)
blast_df_filter_count %>% filter(n ==2 ) %>% dim(.)
dim(blast_df_filter_count)
11363/34211
blast_df_filter %>% group_by(sseqid == "A200FVABXX:2:1:16316:24208#GCCAAT/2")
blast_df_filter %>% group_by(sseqid == "A200FVABXX:2:1:16316:24208#GCCAAT/2")
blast_df_filter %>% filter(sseqid == "A200FVABXX:2:1:16316:24208#GCCAAT/2")
head(blast_df_filter_count)
blast_df_filter %>% filter(sseqid == "A200FVABXX:2:1:13876:140816#GCCAAT/1")
dim(blast_df_filter)
unique(blast_df_filter$sseqid) %>% length()
blast_df_filter %>% filter(sseqid == "A200FVABXX:2:1:16316:24208#GCCAAT/2")
head(blast_df_filter_count)
head(blast_df_filter_count, 10)
blast_df_filter %>% filter(sseqid == "A200FVABXX:2:1:19449:192141#GCCAAT/2")
head(blast_df_filter_count)
blast_df_filter_count<-blast_df_filter %>% group_by(sseqid) %>% count()%>% filter(n==2) #11363/34211 ~33%
dim(blast_df_filter_count)
blast_df_filter_dups <- blast_df_filter %>% filter(sseqid %in% blast_df_filter_count$sseqid)
unique(blast_df_filter_dups$sseqid)
dim(blast_df_filter_dups)
22726/2
head(blast_df_filter_dups)
blast_df_filter_dups %>%group_by(sseqid) %>% mutate(diff = max(pident) - min(pident)) %>% head()
test <-blast_df_filter_dups %>%group_by(sseqid) %>% mutate(diff = max(pident) - min(pident))
head(test)
as.data.frame(test)
test %>% as.data.frame() %>% head()
hist(test$diff)
max(test$diff)
test %>% filter(diff == 5) %>% as.data.frame()
test %>% filter(diff == 0) %>% dim()
test %>% filter(diff == 0) %>% distinct(sseqid) %>% dim()
1100/34211
0.0321534 *100
test %>% filter(sseqid == "B201LRABXX:4:46:13174:110695#GCCAATA/2 ")
test %>% filter(sseqid == "B201LRABXX:4:46:13174:110695#GCCAATA/2")
head(blast_df_filter_dups)
blast_df_filter_dups %>% as.data.frame() %>% head()
test %>% filter(sseqid == "FC615DRAAXX:2:102:6399:8570#0/1")
test %>% filter(sseqid == "FC615DRAAXX:2:34:5938:8226#0/2")
tail(blast_df_filter_dups)
tail(blast_df_filter_dups) %>% as.data.frame()
test %>% filter(sseqid == "A201L5ABXX:3:22:6611:13881#ACTTGAA/1")
compare_UC_clusters
require(tidyverse)
compare_C_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-CD",
col_names = F, delim = "\t")
names(compare_C_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_C_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
compare_C_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 ) %>% as.data.frame()
compare_C_clusters %>% filter(slen<qlen)
compare_C_clusters %>% filter(slen<qlen) %>% as.data.frame()
compare_C_clusters %>% filter(qlen<slen)
compare_C_clusters %>% filter(slen<qlen) %>% as.data.frame()
compare_C_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_C_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100)
compare_CD_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-CD_against-C",
col_names = F, delim = "\t")
names(compare_CD_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_CD_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 )
compare_CD_clusters %>% filter(qlen<slen) %>% filter(qcovs >=95 ) %>% as.data.frame()
compare_CD_clusters %>% filter(slen<qlen) %>% mutate(sqcovs=((pmax(sstart,send)-pmin(sstart,send))/slen )*100) %>% filter( sqcovs >=95)
compare_CD_clusters %>% filter(slen<qlen)
26002-7325
18677/26002
compare_CD_clusters %>% filter(qlen<slen)
compare_CD_clusters
compare_CD_clusters %>% as.data.frame()
32618-13950
18668/26002
25485-10662
14823/26002
26002-11170
14832/26002
compare_UC_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-UC_against-C",
col_names = F, delim = "\t")
compare_UC_clusters
compare_C_UC_clusters <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/compare-enriched-C_against-UC",
col_names = F, delim = "\t")
names(compare_C_UC_clusters)<- c("sseqid", "qseqid", "slen","qlen", "qcovs", "pident", "evalue", "bitscore", "qstart", "qend", "sstart", "send")
compare_C_UC_clusters %>% filter(qlen<slen)
compare_C_UC_clusters %>% filter(qlen<slen) %>% as.data.frame()
compare_C_UC_clusters %>% filter(qlen<slen) %>% as.data.frame()
compare_C_UC_clusters %>% filter(slen<qlen)
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
filterBlastReads<-function(blastDF){
filterDF<-data.frame()
for (i in 1:nrow(blastDF)){
external <- NULL
row <- blastDF[i,]
smin <- min(row$sstart, row$send)
smax <- max(row$sstart, row$send)
qmin <- min(row$qstart, row$qend)
qmax <- max(row$qstart, row$qend)
percentReadCoveredByCluster <- ((smax - smin + 1) / (row$slen) )* 100
if(qmin - 1 >= smin - 1  && row$qlen - qmax >= row$slen - smax){
external <- TRUE
}else{
external <- FALSE}
if (external == TRUE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 90)){
row$readPos <- "external"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )
}} else if (external == FALSE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 50)){
row$readPos <- "edge"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )}}
}
return(filterDF)
}
blast_df_filter<-filterBlastReads( blast_df %>% filter(qseqid != "smNRPS-BP"))
head(blast_df)
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
head(blast_df)
dim(blast_df)
tail(blast_df)
blast_df %>% filter(sstart !=1 | send !=1)
blast_df %>% filter(sstart !=1 & send !=1)
blast_df %>% filter(sstart !=1 & send !=1) %>% as.data.frame()
blast_df %>% filter(sstart ==1 | send ==1) %>% as.data.frame()
blast_df %>% filter(sstart ==1 | send ==1) %>% as.data.frame() %>% dim()
blast_df %>% filter(sstart !=1 & send !=1) %>% dim()
44587+3676
compare BLAST reads that mapped to our smNRPS-clusters
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
filterBlastReads<-function(blastDF){
filterDF<-data.frame()
for (i in 1:nrow(blastDF)){
internal <- NULL
row <- blastDF[i,]
smin <- min(row$sstart, row$send)
smax <- max(row$sstart, row$send)
qmin <- min(row$qstart, row$qend)
qmax <- max(row$qstart, row$qend)
percentReadCoveredByCluster <- NULL
if(smin ==1){
percentReadCoveredByCluster <- ((smax - smin + 1) / (row$slen) )* 100
} else{
percentReadCoveredByCluster <- ((smax - smin) / (row$slen) )* 100
}
if(qmin - 1 >= smin - 1  && row$qlen - qmax >= row$slen - smax){
internal <- TRUE
}else{
internal <- FALSE}
if (internal == TRUE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 90)){
row$readPos <- "internal"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )
}} else if (internal == FALSE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 50)){
row$readPos <- "edge"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )}}
}
return(filterDF)
}
blast_df_filter<-filterBlastReads( blast_df %>% filter(qseqid != "smNRPS-BP"))
head(blast_df_filter)
blast_df_filter_count<-blast_df_filter %>% group_by(sseqid) %>% count()%>% filter(n==2)
dim(blast_df_filter_count)
head(blast_df_filter)
blast_df_filter %>% filter(readCov == 50) %>% head()
86-43
44/86
blast_df <- read_delim("compare-MetaHIT-HMP2-enriched-bgcs/rainin-combined-BLAST-data.txt", col_names = T, delim= "\t")
filterBlastReads<-function(blastDF){
filterDF<-data.frame()
for (i in 1:nrow(blastDF)){
internal <- NULL
row <- blastDF[i,]
smin <- min(row$sstart, row$send)
smax <- max(row$sstart, row$send)
qmin <- min(row$qstart, row$qend)
qmax <- max(row$qstart, row$qend)
percentReadCoveredByCluster <- ((smax - smin + 1) / (row$slen) )* 100
if(qmin - 1 >= smin - 1  && row$qlen - qmax >= row$slen - smax){
internal <- TRUE
}else{
internal <- FALSE}
if (internal == TRUE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 90)){
row$readPos <- "internal"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )
}} else if (internal == FALSE){
if ((row$pident >= 95.0) && (percentReadCoveredByCluster>= 50)){
row$readPos <- "edge"
row$readCov <- percentReadCoveredByCluster
filterDF<-rbind(row,filterDF )}}
}
return(filterDF)
}
blast_df_filter<-filterBlastReads( blast_df %>% filter(qseqid != "smNRPS-BP"))
blast_df_filter_count<-blast_df_filter %>% group_by(sseqid) %>% count()%>% filter(n==2) #11363/34211 ~33%
blast_df_filter_dups <- blast_df_filter %>% filter(sseqid %in% blast_df_filter_count$sseqid)
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1, max(pident))
unique(blast_df_filter_dups_max$sseqid) %>% length()
dim(blast_df_filter_dups_max)
head(blast_df_filter_dups_max)
head(blast_df_filter_dups)
dim(blast_df_filter_dups)
blast_df_filter_count<-blast_df_filter %>% group_by(sseqid) %>% count()%>% filter(n==2) %>% ungroup()#11363/34211 ~33%
blast_df_filter_dups <- blast_df_filter %>% filter(sseqid %in% blast_df_filter_count$sseqid)
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1, max(pident))
test <-blast_df_filter_dups %>%group_by(sseqid) %>% mutate(diff = max(pident) - min(pident))
hist(test$diff)
test %>% filter(diff == 5 )
blast_df_filter_dups_max %>% filter(sseqid == "FC615DRAAXX:3:7:2654:8412#0/2")
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1,pident)
blast_df_filter_dups_max %>% filter(sseqid == "FC615DRAAXX:3:7:2654:8412#0/2")
dim(blast_df_filter_dups_max)
unique(blast_df_filter_dups_max$sseqid) %>% length()
12463-11363
test %>% filter(diff == 0) %>% dim()
test %>% filter(diff == 0) %>% head()
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1,pident) %>% top_n(1,evalue)
head(blast_df_filter_dups_max)
blast_df_filter_dups_max %>% filter(sseqid == "I326_1_FC30VYFAAXX:4:35:1133:1081/2")
4.96e-17<5.02e-17
head(rank)
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1,pident) %>% mutate(rank = rank(evalue, ties.method = "min"))
head(blast_df_filter_dups_max)
blast_df_filter_dups_max <-blast_df_filter_dups %>% group_by(sseqid) %>% top_n(1,pident) %>% mutate(rank = rank(evalue, ties.method = "min"))%>% filter(rank == 1)
dim(blast_df_filter_dups_max)
dim(test)
22726/2
head(blast_df_filter_dups_max)
rm(test)
head(blast_df_filter_dups_max)
blast_df_filter_dups %>% head()
blast_df_filter_dups %>% filter(sseqid == "FC615DRAAXX:2:34:5938:8226#0/2")
blast_df_filter_dups_max %>% filter(sseqid == "FC615DRAAXX:2:34:5938:8226#0/2")
head(blast_df_filter_dups_max)
dim(blast_df_filter_dups_max)
blast_df_filter_dups_max %>% group_by(qseqid,Sample) %>% count() %>% ggplot(x=Sample, y=n) +geom_col() + facet_wrap(~qseqid)
blast_df_filter_dups_max %>% group_by(qseqid,Sample) %>% count() %>% ggplot(aes(x=Sample, y=n)) +geom_col() + facet_wrap(~qseqid)
dim(blast_df_filter_dups_max)
table(blast_df_filter_dups_max$qseqid)
blast_df_filter_dups_max %>% filter(duplicated(sseqid))
head(blast_df_filter_dups_max)
blast_df_filter_dups_max %>% dim()
unique(blast_df_filter_dups_max$sseqid) %>% length()
blast_df_filter_dups_max %>% select(c(-rank, -readPos,-readCov)) %>% head()
write_delim(blast_df_filter_dups_max %>% select(c(-rank, -readPos,-readCov)), "smNRPS-MetaHIT-mapped-filter-reads.txt", delim = "\t")
load("/Users/francinecamacho/Documents/Donia_analysis/HMP-published-metaBGC/hmm-reads-price/TcmN-v2-model/TcmN-hmm_unique-BLAST-HMP-results.RData")
sample_smnrps_df <- read_delim("smNRPS-MetaHIT-mapped-filter-reads.txt", col_names = T, delim = "\t")
paste0("Rainin-clusters-exact-unique-reads-vs-","V1.CD10.0","-tabular-blast", ".txt", sep="")
paste0("smNRPS-exact-unique-reads-vs-","V1.CD10.0","-tabular-blast", ".txt", sep="")
sample_smnrps_df <- read_delim("smNRPS-MetaHIT-mapped-filter-reads.txt", col_names = T, delim = "\t")
parseReadID<- function(df){
setwd("/Users/francinecamacho/Documents/Donia_analysis/smNRPS-manuscript/smNRPS-Crohns/data/smNRPS-exact-unique-reads")
samples<-unique(df$Sample)
for (s in 1:length(samples)){
currentSample<-samples[s]
currentSampleResults<- df %>% filter(Sample == currentSample)
fileName<-paste0("smNRPS-exact-unique-reads-vs-",currentSample,"-tabular-blast", ".txt", sep="")
write_delim(currentSampleResults,fileName, delim="\t", col_names = F )
}}
parseReadID(sample_smnrps_df)
unique(sample_smnrps_df$Sample) %>% length()
sample_smnrps_df <- read_delim("smNRPS-MetaHIT-mapped-filter-reads.txt", col_names = T, delim = "\t")
parseReadID<- function(df){
setwd("/Users/francinecamacho/Documents/Donia_analysis/smNRPS-manuscript/smNRPS-Crohns/data/smNRPS-exact-unique-reads")
samples<-unique(df$Sample)
for (s in 1:length(samples)){
currentSample<-samples[s]
currentSampleResults<- df %>% filter(Sample == currentSample)
fileName<-paste0("smNRPS-exact-unique-reads-vs-",currentSample,"-tabular-blast", ".txt", sep="")
write_delim(currentSampleResults %>% select(-c(Sample)),fileName, delim="\t", col_names = F )
}}
parseReadID(sample_smnrps_df)
