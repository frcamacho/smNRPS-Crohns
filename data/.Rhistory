coord_polar("y") +
geom_text(aes(label = paste0(share, "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "market share") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
head(pi.test)
581/856
581/956
pi.test <- test %>% group_by(PHYLUM) %>% count() %>% ungroup() %>%  mutate(share=n/sum(n)*100.0) %>% arrange(desc(n))
pi.test$PHYLUM <- factor(pi.test$PHYLUM, levels = pi.test$PHYLUM[order(pi.test$share)])
pi.test$PHYLUM <- factor(pi.test$PHYLUM, levels = pi.test$PHYLUM[order(pi.test$share)])
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,2), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "market share") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
pi.test <- test %>% group_by(PHYLUM) %>% count() %>% ungroup() %>%  mutate(share=n/sum(n)*100.0) %>% arrange(desc(n))
pi.test$PHYLUM <- factor(pi.test$PHYLUM, levels = pi.test$PHYLUM[order(pi.test$share)])
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "market share") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
?
geom_text
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 1)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "market share") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
?position_stack
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "market share") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL,
title = "Phylum Proportions ") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "#666666"))
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic()
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+geom_label_repel(data = my_labels, aes(x = x.breaks, y = y.breaks,
label = labels, fill = PHYLUM),
label.padding = unit(0.1, "lines"),
size = 2,
show.legend = FALSE,
inherit.aes = FALSE)
?geom_label_repel
library(ggrepel)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(data = my_labels, aes(x = x.breaks, y = y.breaks,
label = labels, fill = PHYLUM),
label.padding = unit(0.1, "lines"),
size = 2,
show.legend = FALSE,
inherit.aes = FALSE)
pi.test$PHYLUM <- factor(pi.test$PHYLUM, levels = pi.test$PHYLUM[order(pi.test$share)])
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(data = pi.test, aes(x = x.breaks, y = y.breaks,
label = labels, fill = PHYLUM),
label.padding = unit(0.1, "lines"),
size = 2,
show.legend = FALSE,
inherit.aes = FALSE)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y") +
geom_text(aes(label = paste0(round(share,1), "%")),
position = position_stack(vjust = 0.5)) +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(aes(label = share), color = 'white',
size = 3.5)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank()) +
geom_label_repel(aes(label = share), color = 'white',
size = 3.5)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank()) +
geom_label_repel(aes(label = round(share,1)), color = 'white',
size = 3.5)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+geom_label_repel(aes(label = share), color = 'white',
size = 3.5)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(aes(label = share), color = 'white',
size = 3.5, nudge_x = 1.6)
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(aes(label = share), color = 'white',
size = 3.5, nudge_x = .2)
blank_theme <- theme_minimal()+
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text =  element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
plot.title=element_text(size=14, face="bold")
)
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 2) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 3.5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 3.5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0)
test %>%
group_by(PHYLUM) %>%
summarise(n = n()) %>%
mutate(perc = n / sum(n)) %>%
mutate(label = paste0(PHYLUM, "\n", scales::percent(perc))) %>%
arrange(desc(perc)) %>%
ggplot(aes(x = "", y = perc)) +
geom_col(aes(fill = reorder(PHYLUM, perc)),
width = 1,
col = "white") +
geom_label(x = 1.2,
aes(y = cumsum(perc) - perc / 2,
label = label,
col = reorder(PHYLUM, perc)),
size = 5) +
coord_polar(theta = "y", start = 0) +
guides(col = FALSE, fill = FALSE) +
blank_theme + scale_fill_npg()+scale_color_npg()
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(aes(label = share), color = 'white',
size = 3.5)
species_df <- read_csv("species-profiler-results/species_results-MetaHIT-spanish_UniProt.csv", col_names = T)
test<-species_df
test[is.na(test)]<-"N/A"
test$PHYLUM <- ifelse(test$PHYLUM == "N/A", test$Manual_PHYLUM, test$PHYLUM)
test$ORGANISM <- ifelse(test$ORGANISM == "N/A", test$Manual_ORGANISM, test$ORGANISM)
test$PHYLUM[test$PHYLUM == "N/A" ] <-"Unassigned"
pi.test <- test %>% group_by(PHYLUM) %>% count() %>% ungroup() %>%  mutate(share=n/sum(n)*100.0) %>% arrange(desc(n))
pi.test$PHYLUM <- factor(pi.test$PHYLUM, levels = pi.test$PHYLUM[order(pi.test$share)])
ggplot(pi.test, aes("", share, fill = PHYLUM)) +
geom_bar(width = 1, size = 1, color = "white", stat = "identity") +
coord_polar("y")  +
labs(x = NULL, y = NULL, fill = NULL) +
guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_npg() +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())+
geom_label_repel(aes(label = share), color = 'white',
size = 3.5)
